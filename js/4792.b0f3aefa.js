"use strict";(self["webpackChunkwap"]=self["webpackChunkwap"]||[]).push([[4792],{4792:function(e,t,i){i.r(t),i.d(t,{default:function(){return u}});var s=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("div",{staticStyle:{"border-bottom":"1px solid #eee","margin-bottom":"12px","box-shadow":"1px 0px 10px #ccc"}},[t("van-nav-bar",{attrs:{title:"问卷调查"}})],1),t("van-form",[e._l(e.dataList,(function(i,s){return t("div",{key:s,staticClass:"item-wrap"},[0==i.IsMultiSelect?t("div",[t("div",{staticClass:"title"},[t("span",[e._v(e._s(s+1)+"."+e._s(i.Title))])]),t("div",{staticClass:"content"},[t("van-field",{attrs:{name:"radio"},scopedSlots:e._u([{key:"input",fn:function(){return[t("van-radio-group",{model:{value:i.checkedId,callback:function(t){e.$set(i,"checkedId",t)},expression:"item.checkedId"}},e._l(i.QuestionOptionList,(function(i,s){return t("van-radio",{key:s,class:e.tagColor===i.name?"bordercolor":"",attrs:{name:i.Id,disabled:e.isVote},on:{click:function(t){return e.changeColor(i.name)}}},[e._v(e._s(i.Code))])})),1)]},proxy:!0}],null,!0)})],1)]):1==i.IsMultiSelect?t("div",[t("div",{staticClass:"title"},[t("span",[e._v(" "+e._s(s+1)+"."+e._s(i.Title)+" ")])]),t("div",{staticClass:"content"},[t("van-field",{attrs:{name:"checkboxGroup"},scopedSlots:e._u([{key:"input",fn:function(){return[t("van-checkbox-group",{attrs:{disabled:e.isVote},model:{value:i.checkedId,callback:function(t){e.$set(i,"checkedId",t)},expression:"item.checkedId"}},e._l(i.QuestionOptionList,(function(i,s){return t("van-checkbox",{key:s,class:-1===e.result.indexOf(i.name)?"1":"bordercolor",attrs:{name:i.Id,shape:"square"}},[e._v(e._s(i.Code))])})),1)]},proxy:!0}],null,!0)})],1)]):e._e()])})),t("div",{staticStyle:{margin:"18px 30px"}},[e.isVote?e._e():t("van-button",{attrs:{round:"",block:"",type:"info"},on:{click:e.submit}},[e._v("提交")])],1)],2)],1)},n=[],a={data(){return{radio:1,result:[],message:"",tagColor:0,dataList:[],isVote:!1,Questionnaire:[]}},methods:{changeColor(e){e&&(this.tagColor=e)},QSMS_QuestionnaireDetails(){this._api.QSMS_QuestionnaireDetails({Id:this.$route.query.QuestionnaireId}).then((e=>{e&&e.data&&e.data.QuestionList&&(this.dataList=e.data.QuestionList,this.Questionnaire=e.data.Questionnaire,e.data.Questionnaire.KpsList.length&&this.$u.confirm("评测结果不保存，如需保存请自行截图！").then((()=>{})).catch((()=>{})),this.QSMS_QuestionnairePersoniDetails(this.$route.query.QuestionnaireId))}))},QSMS_QuestionnairePersoniDetails(e){this._api.QSMS_QuestionnairePersoniDetails({questionnaireId:e}).then((e=>{if(e)if(e.data&&0!=e.data.VotingRecordList.length){this.isVote=!0;for(let i of e.data.VotingRecordList)for(let e of this.dataList)e.Id==i.QuestionId&&(e.checkedId||(e.checkedId=[]),e.checkedId.push(i.OptionId));for(let e of this.dataList)1==e.checkedId.length&&(e.checkedId=e.checkedId.join(","));let t=JSON.parse(JSON.stringify(this.dataList));this.dataList=[],setTimeout((()=>{this.dataList=t}))}else this.isVote=!1;this.loading=!1}))},submit(){let e=JSON.parse(localStorage.getItem("myInfo")),t="5c4edc3a-b094-4656-894a-faff28b684a1",i={ModuleId:t,QuestionnaireId:this.$route.query.QuestionnaireId,PsersonId:e.Id,MemberId:e.Id,VotingRecordList:[]},s=!0;for(let n of this.dataList)if(n.IsMultiSelect){for(let s of n.checkedId)for(let a of n.QuestionOptionList)if(a.Id==s){let s={QuestionId:n.Id,QuestionnaireId:this.QuestionnaireId,PsersonId:e.Id,MemberId:e.Id,ModuleId:t,OptionId:a.Id,Avalue:a.Avalue,FValue:a.FValue};i.VotingRecordList.push(s)}}else if(n.checkedId){for(let s of n.QuestionOptionList)if(s.Id==n.checkedId){let a={QuestionId:n.Id,QuestionnaireId:this.QuestionnaireId,PsersonId:e.Id,MemberId:e.Id,ModuleId:t,OptionId:s.Id,Avalue:s.Avalue,FValue:s.FValue};i.VotingRecordList.push(a)}}else s=!1;if(0!=s)if(0===this.Questionnaire.KpsList.length)this._api.QSMS_QuestionnairePersonVoting(i).then((e=>{0==e.errcode?(this.$u.msg("投票成功！"),this.$router.back()):this.$u.msg("发生错误！投票失败！","error")}));else{let e=i.VotingRecordList.reduce(((e,t)=>e+t.FValue),0);for(let t of this.Questionnaire.KpsList)if(t.MinValue>e&&e<t.MaxValue){this.$u.confirm(t.Description,"","确认",`${t.Summary}(${e}分)`,!1).then((()=>{this.$router.back()})).catch((()=>{}));break}}else this.$u.msg("投票失败！投票未完成！")}},mounted(){if(this.$route.query.QuestionnaireId){let e=(new Date).getTime();if(e>this.$route.query.StartTime)return this.$u.msg("活动已过期！","/static/img/warning.png");this.QSMS_QuestionnaireDetails()}}},o=a,r=i(3736),d=(0,r.Z)(o,s,n,!1,null,null,null),u=d.exports}}]);
//# sourceMappingURL=4792.b0f3aefa.js.map