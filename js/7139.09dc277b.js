"use strict";(self["webpackChunkwap"]=self["webpackChunkwap"]||[]).push([[7139],{7139:function(e,t,i){i.r(t),i.d(t,{default:function(){return u}});var s=function(){var e=this,t=e._self._c;return t("popup",{staticClass:"main-page"},[t("form",{staticClass:"h-form"},[e._l(e.config,(function(i,s){return t("item",{directives:[{name:"show",rawName:"v-show",value:i.Visibility.includes(1),expression:"item.Visibility.includes(1)"}],key:s,attrs:{name:i.FieldName,hiddenout:29==i.FieldType,must:!!i.IsRequried,width:i.ItemWidth||"xl",pd:6==i.FieldType||15==i.FieldType||17==i.FieldType||13==i.FieldType}},[t("h-renderItem",{attrs:{render:i.render,info:e.info}})],1)})),t("h-renderItem",{attrs:{render:e.customRender,info:e.info}})],2),t("h-submitBtn",{ref:"sub",attrs:{slot:"btns"},on:{submit:e.submit},slot:"btns"}),t("h-person",{ref:"person",on:{getPerson:e.getPerson}})],1)},a=[],l=i(9669),r=i.n(l),o={name:"FormAE",props:{apis:{edit:null,create:null,details:null},FormsCode:{tyep:String},initAfterFun:{type:Function,default:null},loadAfterFun:{type:Function,default:null},submitBefore:{type:Function,default:null},upLoadBeforSubmit:{type:Boolean,default:()=>!1},imgNameField:{type:String,default:"CoverImg"},customRender:{type:Function,default:()=>{}}},components:{},data(){return{info:{FStatus:1,EntryList:[]},rules:{},config:[],personNameField:null,personIdField:null}},methods:{async start(e){this.init(),this.initAfterFun&&this.initAfterFun(e,this.info,this),this.$refs.popup.startLoading(),this.$refs.popup.start(e?"编辑":"新增"),e||(this.info.isAdd=!0),this.FormsCode&&await this.showItems(),e?(this.getDetails(e.Id),this.fileQueryList(e.Id),this.$emit("beforeEdit")):(this.upLoadBeforSubmit&&(this.info.Id=this.$guid.raw()),this.$refs.popup.closeLoading())},getDetails(e){this.apis.details({Id:e}).then((e=>{e&&(this.info=e.data,this.loadAfterFun&&this.loadAfterFun(this.info,this),this.personNameField&&this.personIdField&&this.$refs.person.back([{PersonName:e[this.personNameField],Id:e[this.personIdField]}]))}))},async submit(){await this.$u.checkForm(this.info,this.rules),this.submitBefore&&this.submitBefore(this.info,this),this.$refs.sub.loading(),this.upLoadBeforSubmit&&await this.upLoadFile(this.info.Id);let e=this.info.isAdd?this.apis.create:this.apis.edit;e(this.info).then((e=>{e&&(this.$refs.popup.close(),this.$emit("refresh"),this.$u.msg(this.info.Id?"编辑成功！":"创建成功！"),this.upLoadBeforSubmit||this.upLoadFile(this.info.Id||e.data)),this.$refs.sub.cancelLoading()}))},upLoadFile(e){if(this.$refs.upLoad?.reUp){let t=[];for(let i of this.$refs.upLoad.fileList)i.Id||t.push(this._api.upLoad({file:i,Classify:2,SourceId:e}));return r().all(t).then((e=>{e&&this.upLoadBeforSubmit&&(this.info[this.imgNameField]=e[0].data)}))}},fileQueryList(e){this.$refs.upLoad&&this._api.fileQueryList({SourceId:e}).then((e=>{e&&(this.$refs.upLoad.fileList=e.data)}))},async showItems(){this.$createElement;let e=await this._api.BOS_FormsDetail({FormCode:this.FormsCode}),t=e.data.FieldsList.sort(((e,t)=>e.RowId-t.RowId));if(!e||!t.length)return this.$refs.popup.closeLoading();for(let i of t)if(i.IsRequried&&(this.rules[i.FieldId]=i.Placeholder),i.Options&&i.Options.includes("{")&&(i.Options=JSON.parse(i.Options)),i.JsonString?i.JsonString=JSON.parse(i.JsonString):i.JsonString={RelationshipField:0,RelationshipFields:[]},i.Visibility=i.Visibility?JSON.parse(i.Visibility):[],i.ApiUrl){i.render=(e,t)=>e("el-input",{attrs:{placeholder:i.Placeholder},model:{value:t[i.FieldId],callback:e=>{this.$set(t,i.FieldId,e)}}});let e=await this._api.customApi(i.ApiUrl);e&&(i.render=(t,s)=>{if(7==i.FieldType)return t("el-select",{attrs:{placeholder:i.Placeholder},style:"width:100%",model:{value:s[i.FieldId],callback:e=>{this.$set(s,i.FieldId,e)}}},[e.data.map((e=>t("el-option",{attrs:{label:e[i.Options.label],value:e[i.Options.value]}})))]);if(9==i.FieldType)return t("treeInputMultiple",{attrs:{dataList:e.data,fieldName:i.Options.label,placeholder:i.Placeholder},model:{value:s[i.FieldId],callback:e=>{this.$set(s,i.FieldId,e)}}});if(11==i.FieldType){let a=this.$u.arraytoTree(e.data);return t("h-selectTree",{attrs:{data:a,label:i.Options.label,placeholder:i.Placeholder,inputWidth:"100%"},ref:i.Ref,model:{value:s[i.FieldId],callback:e=>{this.$set(s,i.FieldId,e)}}})}})}else i.render=this.getRender(i);this.config=e.data.FieldsList,this.$refs.popup.closeLoading()},getRender({FieldType:e,FieldId:t,Placeholder:i,Options:s,Unit:a,MaxValue:l,MinValue:r,DefaultValue:o}){this.$createElement;return(d,n)=>{let h=d("span");switch(e){case 1:h=d("el-input",{attrs:{placeholder:i,clearable:!0},model:{value:n[t],callback:e=>{this.$set(n,t,e)}}});break;case 2:h=d("el-input",{attrs:{type:"number",placeholder:i,maxlength:l,minlength:r},model:{value:n[t],callback:e=>{this.$set(n,t,e)}}},[d("span",{slot:"suffix"},[a])]);break;case 23:h=d("el-input",{attrs:{placeholder:i,type:"textarea"},model:{value:n[t],callback:e=>{this.$set(n,t,e)}}});break;case 3:o&&(n[t]=new Date),h=d("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",format:"yyyy-MM-dd",placeholder:i,clearable:!0},model:{value:n[t],callback:e=>{this.$set(n,t,e)}}});break;case 4:o&&(n[t]=new Date),h=d("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm",format:"yyyy-MM-dd HH:mm",placeholder:i,clearable:!0},model:{value:n[t],callback:e=>{this.$set(n,t,e)}}});break;case 5:h=d("el-select",{attrs:{placeholder:i},style:"width:100%",model:{value:n[t],callback:e=>{this.$set(n,t,e)}}},[s.map((e=>d("el-option",{attrs:{label:e.label,value:e.value}})))]);break;case 15:h=d("h-upload",{attrs:{limitCount:"10"},ref:"upLoad"});break;case 17:h=d("h-upload",{attrs:{limitCount:l,type:"img"},ref:"upLoad"});break;case 13:h=d("el-radio-group",{attrs:{placeholder:i},style:"width:100%",model:{value:n[t],callback:e=>{this.$set(n,t,e)}}},[s.map((e=>d("el-radio",{attrs:{label:e.value}},[e.label])))]);break;case 29:let e={serverUrl:"/FMS/api/UEditor",initialFrameHeight:400,UEDITOR_HOME_URL:"/UEditor/"};h=d("vue-ueditor-wrap",{attrs:{config:e},model:{value:n[t],callback:e=>{this.$set(n,t,e)}}});break;case 19:h=d("el-input",{attrs:{placeholder:i,readonly:!0},nativeOn:{click:e=>this.choosePerson(l,t,s)},model:{value:n[s],callback:e=>{this.$set(n,s,e)}}});break}return h}},choosePerson(e,t,i){this.personNameField=i,this.personIdField=t,this.$refs.person.start(!(e>1))},async getPerson(e){this.info[this.personIdField]=e[0].PersonId,this.$set(this.info,this.personNameField,e[0].Fname)}},mounted(){}},d=o,n=i(3736),h=(0,n.Z)(d,s,a,!1,null,"37fef9fc",null),u=h.exports}}]);
//# sourceMappingURL=7139.09dc277b.js.map